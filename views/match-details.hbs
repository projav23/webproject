<section>
    {{> menu}}
</section>

<p>Centro del evento: {{match.center}}</p>
<p>Nivel del evento: {{match.level}}</p>
<p>Localidad: {{match.location}}</p>
<p>Creador del evento: {{match.host.id}}</p>
<p>Estado del partido: {{match.status}}</p>
Usuario logueado {{currentUser._id}}



Usuarios aceptados: 
{{#each match.acceptedGuests}}
  <p><a href="/profile/{{id}}">{{id}}</a></p>
{{/each}}

{{#ifeq match.status "Abierto"}}
  {{#ifCond match.host._id currentUser._id}}
    {{#if currentUserIsAccepted}}
      <form action="/matches/{{match._id}}/cancel" method="post">
      <button class="sendToBack" type="submit">Cancelar partido</button>
      </form>
    {{else}}
      {{#ifeq match.acceptedGuests.length match.numberPlayers}}
        <button>No hay plazas disponibles</button>
      {{else}}
      <form action="/matches/{{match._id}}/join" method="post">
      <input type="text" name="pendingGuests" value="{{currentUser._id}}" hidden>
      <button class="sendToBack" type="submit">Join</button>
      </form>
      {{/ifeq}}
    {{/if}}
  {{else}}
    {{#ifeq match.acceptedGuests.length match.numberPlayers}}
    <form action="/matches/{{match._id}}/endMatch" method="post">
    <button class="sendToBack" type="submit">Cerrar partido</button>
    {{/ifeq}}
    </form>
    <form action="/matches/{{match._id}}/delete" method="post">
    <button  class="sendToBack" type="submit">Borrar partido</button>
    </form>
  {{/ifCond}}
{{else}}
  {{#ifCond match.host._id currentUser._id}}
  <a href="#">El partido ha finalizado</a>
  {{else}}
    {{#ifeq match.acceptedGuests.length 4}}
      <form action="/matches/{{match._id}}/winners" method="post" id="winners">
        <button class="sendToBack" type="submit">Enviar resultado</button>
      </form>
        <label for="win">Choose the winners:</label>
          <select name="player1" id="win" form="winners" required>
            <option value={{match.acceptedGuests.[0]._id}}>{{match.acceptedGuests.[0].username}}</option>
            <option value={{match.acceptedGuests.[1]._id}}>{{match.acceptedGuests.[1].username}}</option>
            <option value={{match.acceptedGuests.[2]._id}}>{{match.acceptedGuests.[2].username}}</option>
            <option value={{match.acceptedGuests.[3]._id}}>{{match.acceptedGuests.[3].username}}</option>
          </select>
          <select name="player2" id="win" form="winners" required>
            <option value={{match.acceptedGuests.[0]._id}}>{{match.acceptedGuests.[0].username}}</option>
            <option value={{match.acceptedGuests.[1]._id}}>{{match.acceptedGuests.[1].username}}</option>
            <option value={{match.acceptedGuests.[2]._id}}>{{match.acceptedGuests.[2].username}}</option>
            <option value={{match.acceptedGuests.[3]._id}}>{{match.acceptedGuests.[3].username}}</option>
          </select>
    {{/ifeq}}
    {{#ifeq match.acceptedGuests.length 2}}
      <form action="/matches/{{match._id}}/winners" method="post" id='winners'>
        <button class="sendToBack" type="submit">Enviar resultado</button>
      </form>
      <label for="win">Choose the winners:</label>
        <select name="player1" id="win" form="winners" required>
          <option value={{match.acceptedGuests.[0]._id}}>{{match.acceptedGuests.[0].username}}</option>
          <option value={{match.acceptedGuests.[1]._id}}>{{match.acceptedGuests.[1].username}}</option>
        </select>
    {{/ifeq}}
  {{/ifCond}}
{{/ifeq}}

<iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2992.207630375916!2d2.1554482157275165!3d41.41301130236884!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12a4a2b0936744ed%3A0xa0ae032aac9336fe!2sClub%20Tennis%20de%20la%20Salut!5e0!3m2!1ses!2ses!4v1610380838237!5m2!1ses!2ses" width="400" height="300" frameborder="0" style="border:0;" allowfullscreen="" aria-hidden="false" tabindex="0"></iframe>

